<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ListaComprasApp.ViewModels"
             x:Class="ListaComprasApp.Views.ProdutosPadraoPage"
             x:DataType="viewmodels:ProdutosPadraoViewModel"
             Title="{Binding Title}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource Primary}"
                Padding="20">
            <Label Text="Escolha Produtos para Adicionar"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalTextAlignment="Center" />
        </Border>

        <!-- Filtros -->
        <Border Grid.Row="1" 
                BackgroundColor="LightBlue"
                Padding="15">
            <StackLayout>
                <Label Text="Filtrar Produtos"
                       FontSize="16"
                       FontAttributes="Bold" />

                <Entry Placeholder="Buscar produto..."
                       Text="{Binding Filtro}" />

                <Grid ColumnDefinitions="*,Auto">
                    <Picker Grid.Column="0"
                            Title="Todas as categorias"
                            ItemsSource="{Binding Categorias}"
                            SelectedItem="{Binding CategoriaFiltro}" />

                    <Button Grid.Column="1"
                            Text="Limpar"
                            BackgroundColor="Orange"
                            TextColor="White"
                            Command="{Binding LimparFiltrosCommand}" />
                </Grid>
            </StackLayout>
        </Border>

        <!-- Lista de produtos -->
        <RefreshView Grid.Row="2" 
                     IsRefreshing="{Binding IsBusy}"
                     Command="{Binding CarregarProdutosCommand}">
            <CollectionView ItemsSource="{Binding Produtos}"
                           BackgroundColor="LightGray">
                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="CenterAndExpand" 
                                HorizontalOptions="CenterAndExpand"
                                Padding="50">
                        <Label Text="Nenhum produto encontrado"
                               FontSize="18"
                               HorizontalTextAlignment="Center"
                               TextColor="Gray" />
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:ProdutoPadrao">
                        <Border BackgroundColor="White"
                               Margin="10,5"
                               Padding="15">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>

                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ProdutosPadraoViewModel}}, Path=AdicionarProdutoCommand}"
                                                     CommandParameter="{Binding .}" />
                            </Border.GestureRecognizers>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Ícone do Produto -->
                                <Label Grid.Column="0"
                                       Text="{Binding Icone}"
                                       FontSize="32"
                                       VerticalOptions="Center"
                                       Margin="0,0,15,0" />

                                <!-- Nome e Categoria -->
                                <StackLayout Grid.Column="1" 
                                            VerticalOptions="Center">
                                    <Label Text="{Binding Nome}"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextTransform="Uppercase" />
                                    <Label Text="{Binding CategoriaTexto}"
                                           FontSize="12"
                                           TextColor="Blue" />
                                </StackLayout>

                                <!-- Valor Unitário -->
                                <StackLayout Grid.Column="2" 
                                            VerticalOptions="Center"
                                            HorizontalOptions="End"
                                            Margin="10,0">
                                    <Label Text="{Binding PrecoMedio, StringFormat='R$ {0:F2}'}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           HorizontalTextAlignment="End"
                                           TextColor="Green" />
                                    <Label Text="{Binding UnidadeTexto, StringFormat='por {0}'}"
                                           FontSize="10"
                                           HorizontalTextAlignment="End"
                                           TextColor="Gray" />
                                </StackLayout>

                                <!-- Botão Adicionar -->
                                <Button Grid.Column="3"
                                        Text="+"
                                        FontSize="20"
                                        FontAttributes="Bold"
                                        BackgroundColor="Green"
                                        TextColor="White"
                                        WidthRequest="40"
                                        HeightRequest="40"
                                        CornerRadius="20"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:ProdutosPadraoViewModel}}, Path=AdicionarProdutoCommand}"
                                        CommandParameter="{Binding .}" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>